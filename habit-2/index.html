<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!--Description-->
  

  <!--Author-->
  
  <meta name="author" content="SHIRIN KOU">
  

  <!--Open Graph Title-->
  
  <meta property="og:title" content="Habit result">
  
  <!--Open Graph Description-->
  
  <!--Open Graph Site Name-->
  <meta property="og:site_name" content="Myakushin">
  <!--Type page-->
  
  <meta property="og:type" content="article">
  
  <!--Page Cover-->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- Title -->
  
  <title>Habit result - Myakushin</title>


  <link rel="shortcut icon" href="https://hexo.io/icon/favicon-96x96.png">
  <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css">
  <!-- Custom CSS/Sass -->
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>

  <!-- Nav -->
  <!-- <header class="site-header">
  <div class="header-inside">

    Navigation
    <nav class="navbar">
      <ul>
        <li>
          <a href=/habit/><img src=></a>
        </li>
        <li class="navbar_title">
          <h1>Habit result</h1>
        </li>
        <li class="navbar_title_2">
          <h1 id="state"></h1>
        </li>
      </ul>
    </nav>

  </div>
</header> -->

  <!-- Main Content layoutで指定したejsが表示される部分 -->
  

<!-- HTML -->
<div class="content-area">
  <div class="habit-area">
    <h1>Habit result</h1>
    <h2></h2>

    <table class="habit-table">
      <tr class="habit2">
        <td>水分摂取量について</td>
        <td id="habitResult0"></td>
      </tr>
      <tr class="habit2">
        <td>好みについて</td>
        <td id="habitResult1"></td>
      </tr>
      <tr class="habit2">
        <td>食事量について</td>
        <td id="habitResult2"></td>
      </tr>
      <tr class="habit2">
        <td>アルコールについて</td>
        <td id="habitResult3"></td>
      </tr>
      <tr class="habit2">
        <td>喫煙について</td>
        <td id="habitResult4"></td>
      </tr>
    </table>

    <div class="habitButton">
      <input id="habitButton-inside" class="habitButton-inside" type="button" value="内容を変更・削除">
    </div>
    <div class="habitButton">
      <a href="/">
        <input class="habitButton-inside" type="button" value="HOME">
      </a>
    </div>
  </div>
</div>

  <!-- Footer -->
  <!-- Footer -->
<footer class="site-info">

</footer>

<script src="https://code.jquery.com/jquery-3.4.0.min.js" integrity="sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js" integrity="sha256-H3cjtrm/ztDeuhCN9I4yh4iN2Ybx/y1RM7rMmAesA0k=" crossorigin="anonymous"></script>
<script src="https://www.gstatic.com/firebasejs/5.10.0/firebase.js"></script>
<script>
  // Firebaseの初期化
  var config = {
    apiKey: "AIzaSyCBJVggpI5YAKFnZNDfDhivNg5-DMUb3Uw",
    authDomain: "myakushin.firebaseapp.com",
    databaseURL: "https://myakushin.firebaseio.com",
    projectId: "myakushin",
    storageBucket: "myakushin.appspot.com",
    messagingSenderId: "537042555866"
  };
  firebase.initializeApp(config);
</script>

<script>
  var user = firebase.auth().currentUser;
  var name, email, photoUrl, uid, emailVerified;

  if (user != null) {
    name = user.displayName;
    email = user.email;
    photoUrl = user.photoURL;
    emailVerified = user.emailVerified;
    uid = user.uid;
  };

  // ログイン確認
  const pattern = '/login/'
  const isLoginPage = !!location.href.match(pattern)

  firebase.auth().onAuthStateChanged(function (user) {
    if (user) {
      // ログイン認証済
      console.log('auth user', user);
      document.getElementById('googleDisplayName').innerText = user.displayName + '';
      document.getElementById('img').src = user.photoURL;

      firebase.firestore().collection('user').doc(`${user.uid}`)
        .set({
          uid: user.uid,
          name: user.displayName,
        }, { merge: true })

    } else {
      // No user is signed in.

      if (!isLoginPage) {
        location.href = '/login/'

      }
    }
  });

  // ログアウト
  function signOut() {
    firebase.auth().signOut().then(function () {
      alert('ログアウトしました');
    }).catch(function (error) {
      console.log(error);
      document.getElementById('log').innerText = 'ログアウト失敗';
    });
  }

</script>








<script>

  var btn = $("#habitButton-inside");
  var form = $("#habit-form");
  form.on('submit', check)

  // 各radioにvalueが入っているかcheck
  // 入ってたらfirestoreにデータ保存
  async function check(e) {
    e.preventDefault()
    if ((document.form1.radio00.value) && (document.form1.radio01.value) && (document.form1.radio02.value) &&
      (document.form1.radio03.value) && (document.form1.radio04.value)) {

      //submit buttonを有効にする
      btn.disabled = "false";
      alert("登録しました！あなたの習慣に合わせたアドバイスをします。");

      var user = firebase.auth().currentUser

      await firebase.firestore().collection('user').doc(`${user.uid}`)
        .set({
          habit: {
            'radio00': document.form1.radio00.value,
            'radio01': document.form1.radio01.value,
            'radio02': document.form1.radio02.value,
            'radio03': document.form1.radio03.value,
            'radio04': document.form1.radio04.value,
          }
        }, { merge: true })

      location.href = "/habit-2/"

    } else {

      alert("※未選択の質問があります。");
      //submit buttonを無効にする
      btn.disabled = "true";
    }
  }


  // habit登録済みか確認
  // 登録されていたら/habit-2/へ接続
  const habitPattern = '/habit-2/'
  const isHabitPage = !!location.href.match(habitPattern)

  var habitRef = firebase.firestore().collection("user").doc("Hq3QlNZhc2ZizmszVe96lN6bvgA3").collection('habit');
  // var habitRef = firebase.firestore().collection("user").doc(`${user.uid}`);
  var getDoc = habitRef.get()
    .then(doc => {
      if (!doc.exists) {
        console.log('No such document!');

      } else {

        if (!isHabitPage) {
          location.href = '/habit-2/'

        }
      }
    })

  // async function check(e) {
  //   e.preventDefault()

  //   var habitRef = firebase.firestore().collection("user").doc("Hq3QlNZhc2ZizmszVe96lN6bvgA3");
  //   // var habitRef = firebase.firestore().collection("user").doc(`${user.uid}`);
  //   var getDoc = await habitRef.get()
  //     .then(doc => {
  //       if (!doc.exists) {
  //         console.log('No such document!');

  //       } else {
  //         location.href = '/habit-2/'

  //         // if (!isHabitPage) {
  //         //   location.href = '/habit-2/'

  //         // }
  //       }
  //     })
  // };


</script>



<script>

  firebase.auth().onAuthStateChanged(function (user) {
    if (user) {
      var habitRef = firebase.firestore().collection("user").doc(`${user.uid}`);

      // habit-fieldがあるかcheck
      // ある場合、選択した内容を＠habit-2で表示
      // ない場合、現在の設定 ＠habitを非表示＊未解決
      var getDoc = habitRef.get()
        .then(doc => {
          if (!doc.exists) {
            console.log('No such document!');
            $('#habit2Button').hide();

          } else {
            console.log('Document data:', doc.data().habit.radio00);
            $('#habitResult0').text(doc.data().habit.radio00);
            $('#habitResult1').text(doc.data().habit.radio01);
            $('#habitResult2').text(doc.data().habit.radio02);
            $('#habitResult3').text(doc.data().habit.radio03);
            $('#habitResult4').text(doc.data().habit.radio04);
          }
        })

      //delete habit-field
      $('#habitButton-inside').on("click", async function (e) {
        e.preventDefault()

        // Remove the 'habit' field from the document
        var removeHabit = await habitRef.update({
          habit: firebase.firestore.FieldValue.delete()
        });

        location.href = '/habit/'

      });
    }
  });

</script>




</body>

</html>